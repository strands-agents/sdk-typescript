import { describe, it, expect } from 'vitest'
import type { Role, ReasoningContent, ContentBlock, Message, Messages } from '@/types/messages'

describe('messages types', () => {
  describe('Role type', () => {
    it('accepts "user" as a valid role', () => {
      const role: Role = 'user'
      expect(role).toBe('user')
    })

    it('accepts "assistant" as a valid role', () => {
      const role: Role = 'assistant'
      expect(role).toBe('assistant')
    })
  })

  describe('ReasoningContent interface', () => {
    it('accepts valid reasoning content with text', () => {
      const reasoning: ReasoningContent = {
        text: 'Thinking about the problem...',
      }
      expect(reasoning.text).toBe('Thinking about the problem...')
    })

    it('accepts valid reasoning content with signature', () => {
      const reasoning: ReasoningContent = {
        signature: 'signature-hash-123',
      }
      expect(reasoning.signature).toBe('signature-hash-123')
    })

    it('accepts reasoning content with both text and signature', () => {
      const reasoning: ReasoningContent = {
        text: 'Reasoning process',
        signature: 'sig-456',
      }
      expect(reasoning.text).toBe('Reasoning process')
      expect(reasoning.signature).toBe('sig-456')
    })

    it('allows empty reasoning content object', () => {
      const reasoning: ReasoningContent = {}
      expect(reasoning).toBeDefined()
    })
  })

  describe('ContentBlock interface', () => {
    it('accepts content block with text only', () => {
      const block: ContentBlock = {
        text: 'Hello, world!',
      }
      expect(block.text).toBe('Hello, world!')
    })

    it('accepts content block with toolUse only', () => {
      const block: ContentBlock = {
        toolUse: {
          name: 'calculator',
          toolUseId: 'tool-123',
          input: { operation: 'add', a: 1, b: 2 },
        },
      }
      expect(block.toolUse?.name).toBe('calculator')
    })

    it('accepts content block with toolResult only', () => {
      const block: ContentBlock = {
        toolResult: {
          toolUseId: 'tool-123',
          status: 'success',
          content: [{ text: 'Result: 3' }],
        },
      }
      expect(block.toolResult?.status).toBe('success')
    })

    it('accepts content block with reasoningContent only', () => {
      const block: ContentBlock = {
        reasoningContent: {
          text: 'Analyzing the request',
        },
      }
      expect(block.reasoningContent?.text).toBe('Analyzing the request')
    })

    it('allows empty content block', () => {
      const block: ContentBlock = {}
      expect(block).toBeDefined()
    })

    it('allows multiple fields in content block', () => {
      const block: ContentBlock = {
        text: 'Using calculator',
        toolUse: {
          name: 'calculator',
          toolUseId: 'tool-456',
          input: { operation: 'multiply', a: 5, b: 10 },
        },
      }
      expect(block.text).toBe('Using calculator')
      expect(block.toolUse?.name).toBe('calculator')
    })
  })

  describe('Message interface', () => {
    it('accepts user message with text content', () => {
      const message: Message = {
        role: 'user',
        content: [{ text: 'Hello' }],
      }
      expect(message.role).toBe('user')
      expect(message.content).toHaveLength(1)
      expect(message.content[0]?.text).toBe('Hello')
    })

    it('accepts assistant message with tool use', () => {
      const message: Message = {
        role: 'assistant',
        content: [
          {
            toolUse: {
              name: 'search',
              toolUseId: 'search-1',
              input: { query: 'TypeScript' },
            },
          },
        ],
      }
      expect(message.role).toBe('assistant')
      expect(message.content[0].toolUse?.name).toBe('search')
    })

    it('accepts message with multiple content blocks', () => {
      const message: Message = {
        role: 'assistant',
        content: [{ text: 'Let me help you' }, { text: 'I will use a tool' }, { toolUse: { name: 'tool', toolUseId: 'id', input: {} } }],
      }
      expect(message.content).toHaveLength(3)
    })

    it('accepts message with empty content array', () => {
      const message: Message = {
        role: 'user',
        content: [],
      }
      expect(message.content).toHaveLength(0)
    })
  })

  describe('Messages type', () => {
    it('accepts array of messages', () => {
      const messages: Messages = [
        { role: 'user', content: [{ text: 'Hi' }] },
        { role: 'assistant', content: [{ text: 'Hello' }] },
      ]
      expect(messages).toHaveLength(2)
    })

    it('accepts empty messages array', () => {
      const messages: Messages = []
      expect(messages).toHaveLength(0)
    })

    it('accepts messages with mixed content types', () => {
      const messages: Messages = [
        {
          role: 'user',
          content: [{ text: 'Calculate 5 + 3' }],
        },
        {
          role: 'assistant',
          content: [
            { toolUse: { name: 'calculator', toolUseId: 'calc-1', input: { a: 5, b: 3 } } },
          ],
        },
        {
          role: 'user',
          content: [{ toolResult: { toolUseId: 'calc-1', status: 'success', content: [{ text: '8' }] } }],
        },
      ]
      expect(messages).toHaveLength(3)
    })
  })
})
